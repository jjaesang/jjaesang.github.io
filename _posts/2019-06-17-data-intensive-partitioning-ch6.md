---
layout: post
title:  "[Data-Intensive] Ch6. 파티셔닝 (Partitioning)"
date: 2019-06-17 18:15:12
categories: Data-Intensive-Application 
author : Jaesang Lim˚
tag: Data-Intensive-Application 
cover: "/assets/instacode.png"
---

## 파티셔닝 
'데이터 중심 애플리케이션 설계'를 읽고 정리하고자함

- 대용량 데이터셋을 작은 데이터셋으로 파티셔닝하는 전략에 대해 설명 
> - 저장하고 처리할 데이터가 한대의 서버에서 처리하지 못할 시, 파티셔닝을 해야함

파티셔닝의 목적
1. 핫스팟이 생기지 않게 해야함
> - 불균형적으로 높은 부하를 받는 노드 = 핫스팟
2. 데이터와 질의 부하를 여러장비에 균등하게 분배해야함

그러기 위해서는 ?
- 데이터에 적합한 파티셔닝 방식을 선택해야함
- 노드가 추가/제거 될 때, 파티션 재균형화를 실행해야함 

파티셔닝 방법론 
1. 키 범위 파티셔닝
> - 키가 정렬돼 있고, 개별 파티션은 어떤 최솟값과 최댓값 사이에 속하는 모든 키를 담당함
> - 키가 정렬돼 있어 **범위 질의에 효과적**
> - 정렬 순서가 서로 가까운 키에 자주 접급하면 **핫스팟**이 생길 위험이 있음
> - 일반적으로, 한 파티션이 너무 크면 키범위를 두개로 쪼개  동적으로 재균형화를 실행함 

2. 해시 파티셔닝
> - 각 키에 해싱 함수 적용하고, 개별 파티션은 특정 범위의 해시값으 담당함
> - 키 순서가 보장되지 않아 **범위 질의에 비효율적**이지만, **부하를 균일하게 분산**할 수 있음
> - 보통 고정된 개수의 파티션을 미리 만들어 각 노드에 몇 개씩 파티션을 할당함
> - 노드가 추가/삭제되면 파티션을 통째로 노드사이에서 이동함
> - 동적 파티셔닝 적용 가능

두가지 방법을 섞어서 사용할 수 있음
- 키 일부분은 파티션 식별용으로, 나머지는 정렬용으로 복합키 설계 가능

파티셔닝과 보조 색인 사이의 상호작요 
1. 문서 파티셔닝 색인(지역 색인)
> - 보조 색인을 기본키와 값이 저장된 파티션에 저장
> - 쓸 때는 파티션 하나만 갱신하면 됨
> - 읽을 때는 모든 파티션에 걸쳐 [Scatter gather](https://kldp.org/node/81436)를 실행해야함

2. 용어 파티셔닝 색인(전역 색인)
> - 색인된 값을 사용해서 보조 색인을 별도로 파티셔닝
> - 보조 색인 항목은 기본키의 모든 파티션에 있는 레코드를 포함할 수 있음
> - 문서를 쓸 때는 여러개를 갱신해야함
> - 읽을 때는 단일 파티션에서 실행할 수 있음 

- 모든 파티션은 대부분 독립적으로 동작함
> - 그래서, 파티셔닝된 데이터베이스는 여러 장비에 확장할 수 있음 

- 하지만 여러 파티션에 기롣해야하는 연산은 ..?
- 예를 들어, 한 파티션에는 쓰기 성공했지만, 다른 파티션에서 실패하면..? 
- 이 문제는 다음 블로그, **트랜잭션**에서 다룰 예정

방금까지가 정리였고, 이제 **파티셔닝**에 대해 세세하게 알아봅시다~

---

## 파티셔닝

### 파티셔닝과 복제
![1](https://user-images.githubusercontent.com/12586821/59677741-8c6dab00-9205-11e9-8e19-9c4781307aa7.PNG)

---

### 키-값 데이터 파티셔닝
#### 1. 키 범위 기준 파티셔닝
#### 2. 키의 해시값 기준 파티셔닝
![3](https://user-images.githubusercontent.com/12586821/59677742-8c6dab00-9205-11e9-8cb1-1f70e819cc1a.PNG)
#### 쏠린 작업부하와 핫스팟 완화

---

### 파티셔닝과 보조 색인
#### 1. 문서 기분 보조 색인 파티셔닝

![4](https://user-images.githubusercontent.com/12586821/59677743-8d064180-9205-11e9-8f5c-38690196488c.PNG)
![5](https://user-images.githubusercontent.com/12586821/59677734-8bd51480-9205-11e9-8f49-55656f08cfcc.PNG)
#### 2. 용어 기준 보조 색인 파티셔닝

---

### 파티션 재균형화

#### 1. 해시값에 Mod N 연산 수행

#### 2. 파티션 개수 고정 
![6](https://user-images.githubusercontent.com/12586821/59677736-8bd51480-9205-11e9-81e1-12f1c7fd0c5b.PNG)

#### 3. 동적 파티셔닝

#### 4. 노드 비례 파티셔닝

#### 운영: 자동 재균형화와 수동 재균형화

---

### 요청 라우팅
![7](https://user-images.githubusercontent.com/12586821/59677739-8c6dab00-9205-11e9-8146-3959b28c2da8.PNG)

#### 병렬 질의 실행
![8](https://user-images.githubusercontent.com/12586821/59677740-8c6dab00-9205-11e9-8ef1-c1b4185dad7b.PNG)

